<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="org.sycamore.llmhub.infrastructure.dataobject.mapper.ModelMapper">
    <select id="listModelWithCompanyInfoByApiKey"  resultType="org.sycamore.llmhub.infrastructure.dto.resp.ModelWithCompanyInfoRespDTO">
        SELECT m.id,
               m.model_name,
               m.create_time,
               m.model_server_base_url,
               a.company_name_zh AS author_company_name_zh,
               d.company_name_zh AS deploy_company_name_zh
        FROM model_llm m
                 INNER JOIN
             model_company a ON m.author_company_id = a.id
                 INNER JOIN
             model_company d ON m.deploy_company_id = d.id
                 INNER JOIN
             api_key_model k ON m.id = k.llm_model_id
        WHERE m.del_flag = 0
          AND a.del_flag = 0
          AND d.del_flag = 0
          AND k.del_flag = 0
          AND k.api_key = #{apiKey}
        order by m.create_time desc
    </select>


    <select id="listModelWithCompanyInfo" parameterType="org.sycamore.llmhub.infrastructure.dto.req.ModelPageQueryReqDTO"  resultType="org.sycamore.llmhub.infrastructure.dto.resp.ModelWithCompanyInfoRespDTO">
        SELECT
        m.id,
        m.model_name,
        m.create_time,
        m.model_server_base_url,
        a.company_name_zh AS author_company_name_zh,
        d.company_name_zh AS deploy_company_name_zh
        FROM
        model_llm m
        INNER JOIN
        model_company a ON m.author_company_id = a.id
        INNER JOIN
        model_company d ON m.deploy_company_id = d.id
        WHERE

        m.del_flag = 0
        AND a.del_flag = 0
        AND d.del_flag = 0
        <if test="reqDTO!=null and reqDTO.modelName != null and reqDTO.modelName != ''">
            and
            m.model_name like CONCAT('%',#{reqDTO.modelName},'%')
        </if>
        <if test="reqDTO!=null and reqDTO.authorCompanyId != null and reqDTO.authorCompanyId !='' ">
            and
            m.author_company_id =  #{reqDTO.authorCompanyId}
        </if>
        <if test="reqDTO!=null and reqDTO.deployCompanyId != null and reqDTO.deployCompanyId !='' ">
            and
            m.deploy_company_id = #{reqDTO.deployCompanyId}
        </if>

        order by m.create_time desc
    </select>


    <select id="selectModelBaseInfoById"   resultType="org.sycamore.llmhub.infrastructure.dto.resp.ModelWithCompanyInfoRespDTO">
        SELECT
        m.id,
        m.model_name,
        m.create_time,
        m.model_server_name,
        m.model_server_base_url,
        a.company_name_zh AS author_company_name_zh,
        d.company_name_zh AS deploy_company_name_zh
        FROM
        model_llm m
        INNER JOIN
        model_company a ON m.author_company_id = a.id
        INNER JOIN
        model_company d ON m.deploy_company_id = d.id
        WHERE
            m.id = #{id} and
        m.del_flag = 0
        AND a.del_flag = 0
        AND d.del_flag = 0

        order by m.create_time desc
    </select>
</mapper>
